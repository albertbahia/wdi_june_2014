<!DOCTYPE html>
<html>
<head>
  <link href="//http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">
  <script src="AudioContextMonkeyPatch.js"></script>
  <script src="jquery-1.11.1.min.js"></script>
<script>
$(document).ready(function () {
  var ctx = new AudioContext();
  var audioElement = $('#sliders audio')[0]

  audioElement.addEventListener('play', function(){
    source = ctx.createMediaElementSource(audioElement);

    delay = ctx.createDelay();
    delay.delayTime.value = 0.5;

    feedback = ctx.createGain();
    feedback.gain.value = 0.8;

    filter = ctx.createBiquadFilter();
    filter.frequency.value = 100;
    // filter = context.createBiquadFilter();
    // source.connect(filter); //and of course connect it
    filter.connect(ctx.destination);//now we want to connect that to the output
    filter.type = 3; //this is a lowshelffilter (try excuting filter1.LOWSHELF in your console)
    filter.gain.value = 80;

    filter.frequency.setValueAtTime(0.0, ctx.currentTime);
    filter.frequency.linearRampToValueAtTime(120.0, ctx.currentTime+10);

    delay.connect(feedback);
    feedback.connect(filter);
    filter.connect(delay);

    source.connect(delay);
    source.connect(ctx.destination);
    delay.connect(ctx.destination);
  });

  var controls = $("div#sliders");

  controls.find("input[name='delayTime']").on('input', function() {
    delay.delayTime.value = $(this).val();
    console.log($(this).val())
  });

  controls.find("input[name='feedback']").on('input', function() {
    feedback.gain.value = $(this).val();
    console.log(feedback.gain.value)
  });

  controls.find("input[name='frequency']").on('input', function() {
    filter.filterType.value = 0;
    filter.frequency.value = $(this).val();
    console.log(filter.frequency.value)
  });
});
</script>
</head>

<body>
<div class="demo" id="sliders">
  <audio controls="true" loop="true" src="https://s3.amazonaws.com/spctrl/207558__edtijo__happy-guitar.mp3" class="mutetabId_2442606">
    Your browser doesn't support the audio element.
  </audio>

  <div class="controls">
    delayTime: <input max="1" min="0" name="delayTime" step="0.05" type="range" value="0.5">
    feedback: <input max="0.95" min="0" name="feedback" step="0.05" type="range" value="0">
    cutoff freq: <input max="44000" min="-44000" name="frequency" step="100" type="range" value="1000">
  </div>
</div>
</body>
</html>
